apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ../../../../platform_components/web
namespace: development
commonLabels:
  app: web
  env: development
patchesJson6902:
- target:
    group: apps
    version: v1
    kind: Deployment
    name: web-app
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/image
      value: 658484148438.dkr.ecr.ca-central-1.amazonaws.com/cinchy.web:v5.1.0
    - op: add
      path: /spec/template/spec/volumes/-
      value: 
        name: web-volume-redis-password
        secret:
          secretName: redis-redis-cluster
    - op: add
      path: /spec/template/spec/containers/0/volumeMounts/-
      value: 
        name: web-volume-redis-password
        readOnly: true
        mountPath: "/usr/share/redis/redis-redis-cluster"
- target:
    version: v1
    kind: Secret
    name: web-secret-appsettings
  patch: |-
    - op: replace
      path: /data/appsettings.json
      value: ew0KICAiQ29uZmlnU2V0dGluZ3MiOiB7DQogICAgIkFwcFNldHRpbmdzIjogew0KICAgICAgIlN0c0F1dGhvcml0eVVyaSI6ICJodHRwczovLy9pZHAiLA0KICAgICAgIkFsbG93TG9nRmlsZURvd25sb2FkIjogZmFsc2UsDQogICAgICAiTG9nRGlyZWN0b3J5UGF0aCI6ICIiLA0KICAgICAgIlNTT0xvZ1BhdGgiOiAiIiwNCiAgICAgICJVc2VIdHRwcyI6IHRydWUsDQogICAgICAiSHN0c01heEFnZSI6IDI1OTIwMDAsDQogICAgICAiSHN0c0luY2x1ZGVTdWJEb21haW5zIjogZmFsc2UsDQogICAgICAiSHN0c1ByZWxvYWQiOiBmYWxzZSwNCiAgICAgICJUbHNWZXJzaW9uIjogIjEuMiIsDQogICAgICAiUm91dGVEZWJ1Z2dlckVuYWJsZWQiOiBmYWxzZSwNCiAgICAgICJSZWZyZXNoQ2FjaGVUaW1lSW5NaW4iOiAxMCwNCiAgICAgICJEZWZhdWx0RXhwaXJhdGlvbkNhY2hlVGltZUluTWluIjogMzYwLA0KICAgICAgIkRCVHlwZSI6ICJUU1FMIiwNCiAgICAgICJTdG9yYWdlVHlwZSI6ICI8PHdlYl9zdG9yYWdlX3R5cGU+PiINCiAgICB9LA0KICAgICJSZXZlcnNlUHJveHlTZXR0aW5ncyI6IHsNCiAgICAgICJJc0VuYWJsZWQiOiB0cnVlLA0KICAgICAgIkJhc2VQYXRoIjogIiIsDQogICAgICAiVXNlSHR0cHMiOiB0cnVlDQogICAgfSwNCiAgICAiQ29ubmVjdGlvblN0cmluZ3MiOiB7DQogICAgICAiU3FsU2VydmVyIjogIlVzZXIgSWQ9c3FsYWRtaW47UGFzc3dvcmQ9PHBhc3N3b3JkPjtTZXJ2ZXI9PGRiX2hvc3RuYW1lPjtEYXRhYmFzZT1kZXZlbG9wbWVudDtUcnVzdGVkX0Nvbm5lY3Rpb249RmFsc2U7Q29ubmVjdGlvbiBUaW1lb3V0PTMwO01pbiBQb29sIFNpemU9MTA7IiwNCiAgICAgICJSZWRpcyI6ICJyZWRpcy1yZWRpcy1jbHVzdGVyLnJlZGlzLnN2Yy5jbHVzdGVyLmxvY2FsOjYzNzkiDQogICAgfSwNCiAgICAiQXp1cmVCbG9iU3RvcmFnZVNldHRpbmdzIjogew0KICAgICAgIkNvbm5lY3Rpb25TdHJpbmciOiAiPDx3ZWJfYXp1cmVfYmxvYl9zdG9yYWdlX2Nvbm5fc3RyPj4iLA0KICAgICAgIkNvbnRhaW5lciI6ICI8PHdlYl9zdG9yYWdlX2NvbnRhaW5lcl9uYW1lPj4iLA0KICAgICAgIkJhc2VQYXRoIjogIjw8d2ViX3N0b3JhZ2VfYmFzZXBhdGg+PiINCiAgICB9LA0KICAgICJTM1NldHRpbmdzIjogew0KICAgICAgIkFjY2Vzc0tleSI6ICI8PHdlYl9zM19hY2Nlc3Nfa2V5Pj4iLA0KICAgICAgIlNlY3JldEFjY2Vzc0tleSI6ICI8PHdlYl9zM19zZWNyZXRfYWNjZXNzX2tleT4+IiwNCiAgICAgICJSZWdpb24iOiAiPDxhd3NfcmVnaW9uPj4iLA0KICAgICAgIkJ1Y2tldCI6ICI8PGNpbmNoeV93ZWJfczNfYnVja2V0Pj4iLA0KICAgICAgIkJhc2VQYXRoIjogIjw8d2ViX3N0b3JhZ2VfYmFzZXBhdGg+PiIsDQogICAgICAiU2VydmljZVVSTCI6ICI8PHdlYl9zM19zZXJ2aWNlX3VybD4+Ig0KICAgIH0sDQogICAgIkNsdXN0ZXJDb21tdW5pY2F0aW9uU2V0dGluZ3MiOiB7DQogICAgICAiVXNlS2Fma2EiOiB0cnVlLA0KICAgICAgIkthZmthQ2FjaGVUb3BpYyI6ICIiLA0KICAgICAgIkthZmthQ2xpZW50Q29uZmlnIjogew0KICAgICAgICAiQm9vdHN0cmFwU2VydmVycyI6ICJrYWZrYS1jbHVzdGVyLWthZmthLWJvb3RzdHJhcC5rYWZrYS5zdmMuY2x1c3Rlci5sb2NhbDo5MDkyIg0KICAgICAgfSwNCiAgICAgICJDbHVzdGVySXBBZGRyZXNzZXMiOiAiIiwNCiAgICAgICJDbHVzdGVyQ29tbXVuaWNhdGlvblByb3RvY29sIjogImh0dHAiLA0KICAgICAgIkNsdXN0ZXJDb21tdW5pY2F0aW9uQmFzZVVybCI6ICJ7UFJPVE9DT0x9Oi8ve0lQQUREUkVTU30vQ2luY2h5Ig0KICAgIH0NCiAgfSwNCiAgIkxvZ2dpbmciOiB7DQogICAgIk1pbmltdW1MZXZlbCI6IHsNCiAgICAgICJEZWZhdWx0IjogIkRlYnVnIiwNCiAgICAgICJPdmVycmlkZSI6IHsNCgkJIk1pY3Jvc29mdCI6ICJXYXJuaW5nIiwNCgkJIk1pY3Jvc29mdC5Ib3N0aW5nLkxpZmV0aW1lIjogIkluZm9ybWF0aW9uIg0KCSAgfQ0KICAgIH0NCiAgfSwNCiAgIlNlcmlsb2ciOiB7DQogICAgIk1pbmltdW1MZXZlbCI6IHsNCiAgICAgICJEZWZhdWx0IjogIkRlYnVnIiwNCgkgICJPdmVycmlkZSI6IHsNCgkJIk1pY3Jvc29mdCI6ICJXYXJuaW5nIiwNCgkJIk1pY3Jvc29mdC5Ib3N0aW5nLkxpZmV0aW1lIjogIkluZm9ybWF0aW9uIg0KCSAgfQ0KICAgIH0sDQogICAgIldyaXRlVG8iOiBbDQogICAgICB7DQogICAgICAgICJOYW1lIjogIkNvbnNvbGUiLA0KICAgICAgICAiQXJncyI6IHsNCiAgICAgICAgICAiZm9ybWF0dGVyIjogIlNlcmlsb2cuRm9ybWF0dGluZy5Db21wYWN0LkNvbXBhY3RKc29uRm9ybWF0dGVyLCBTZXJpbG9nLkZvcm1hdHRpbmcuQ29tcGFjdCINCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIF0NCiAgfSwNCiAgIkFsbG93ZWRIb3N0cyI6ICIqIg0KfQ==
- target:
    group: logging.banzaicloud.io
    version: v1beta1
    kind: Output
    name: web-logging-stdout
  patch: |-
    - op: replace
      path: /spec/elasticsearch/index_name
      value: development-web-app
- target:
    group: kafka.strimzi.io
    version: v1beta2
    kind: KafkaTopic
    name: <environment>-datachangenotifications
  patch: |-
    - op: replace
      path: /metadata/name
      value: development-datachangenotifications
    - op: replace
      path: /metadata/namespace
      value: kafka
- target:
    group: networking.istio.io
    version: v1alpha3
    kind: DestinationRule
    name: web-destinationrule
  patch: |-
    - op: replace
      path: /spec/trafficPolicy/loadBalancer/consistentHash/httpCookie/name
      value: development-web-canary