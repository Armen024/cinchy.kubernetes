apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ../../../../platform_components/idp
namespace: development
commonLabels:
  app: idp
  env: development
patchesJson6902:
- target:
    group: apps
    version: v1
    kind: Deployment
    name: idp-app
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/image
      value: 658484148438.dkr.ecr.ca-central-1.amazonaws.com/cinchy.idp:v5.1.0
    - op: add
      path: /spec/template/spec/volumes/-
      value: 
        name: idp-volume-redis-password
        secret:
          secretName: redis-redis-cluster
    - op: add
      path: /spec/template/spec/containers/0/volumeMounts/-
      value: 
        name: idp-volume-redis-password
        readOnly: true
        mountPath: "/usr/share/redis/redis-redis-cluster"
- target:
    version: v1
    kind: Secret
    name: idp-secret-appsettings
  patch: |-
    - op: replace
      path: /data/appsettings.json
      value: ew0KICAiQ29uZmlnU2V0dGluZ3MiOiB7DQogICAgIkFwcFNldHRpbmdzIjogew0KICAgICAgIkNpbmNoeVVyaSI6ICJodHRwczovLyIsDQogICAgICAiQ2VydGlmaWNhdGVQYXRoIjogIi9hcHAvY2luY2h5aWRlbnRpdHlzcnYucGZ4IiwNCiAgICAgICJDZXJ0aWZpY2F0ZVBhc3N3b3JkIjogIiIsDQogICAgICAiU0FNTENsaWVudEVudGl0eUlkIjogIiIsDQogICAgICAiU0FNTElEUEVudGl0eUlkIjogIiIsDQogICAgICAiU0FNTE1ldGFkYXRhWG1sUGF0aCI6ICIiLA0KICAgICAgIlNBTUxTU09TZXJ2aWNlVVJMIjogIiIsDQogICAgICAiU0FNTEVuY3J5cHRlZENlcnRpZmljYXRlUGF0aCI6ICIiLA0KICAgICAgIlNBTUxFbmNyeXB0ZWRDZXJ0aWZpY2F0ZVBhc3N3b3JkIjogIiIsDQogICAgICAiU0FNTFNpZ25DZXJ0aWZpY2F0ZVBhdGgiOiAiIiwNCiAgICAgICJTQU1MU2lnbkNlcnRpZmljYXRlUGFzc3dvcmQiOiAiIiwNCiAgICAgICJBY3NVUkxNb2R1bGUiOiAiIiwNCiAgICAgICJTdHNQdWJsaWNPcmlnaW5VcmkiOiAiaHR0cHM6Ly8vaWRwIiwNCiAgICAgICJNYXhSZXF1ZXN0SGVhZGVyc1RvdGFsU2l6ZSI6IDY1NTM2LA0KICAgICAgIk1heFJlcXVlc3RCdWZmZXJTaXplIjogNjU1MzYsDQogICAgICAiTWF4UmVxdWVzdEJvZHlTaXplIjogLTEsDQogICAgICAiTWFjaGluZUtleVhtbCI6ICIiLA0KICAgICAgIkRwQXBpS2V5UmluZ1BhdGgiOiAiIiwNCiAgICAgICJUbHNWZXJzaW9uIjogIjEuMiIsDQogICAgICAiQ2luY2h5QWNjZXNzVG9rZW5MaWZldGltZSI6ICIwLjAwOjMwOjAwIiwNCiAgICAgICJEYXRhQ2hhbmdlQ2FsbGJhY2tUaW1lb3V0IjogNywNCiAgICAgICJSZWZyZXNoQ2FjaGVUaW1lSW5NaW4iOiAxMCwNCiAgICAgICJEZWZhdWx0RXhwaXJhdGlvbkNhY2hlVGltZUluTWluIjogMzYwLA0KICAgICAgIkRCVHlwZSI6ICJUU1FMIg0KICAgIH0sDQogICAgIkNvbm5lY3Rpb25TdHJpbmdzIjogew0KICAgICAgIlNxbFNlcnZlciI6ICJVc2VyIElkPXNxbGFkbWluO1Bhc3N3b3JkPTxwYXNzd29yZD47U2VydmVyPTxkYl9ob3N0bmFtZT47RGF0YWJhc2U9ZGV2ZWxvcG1lbnQ7VHJ1c3RlZF9Db25uZWN0aW9uPUZhbHNlO0Nvbm5lY3Rpb24gVGltZW91dD0zMDtNaW4gUG9vbCBTaXplPTEwOyIsDQogICAgICAiUmVkaXMiOiAicmVkaXMtcmVkaXMtY2x1c3Rlci5yZWRpcy5zdmMuY2x1c3Rlci5sb2NhbDo2Mzc5Ig0KICAgIH0sDQogICAgIkV4dGVybmFsSWRlbnRpdHlDbGFpbVNlY3Rpb24iOiB7DQogICAgICAiRmlyc3ROYW1lIjogew0KICAgICAgICAiRXh0ZXJuYWxDbGFpbU5hbWUiOiAiIg0KICAgICAgfSwNCiAgICAgICJMYXN0TmFtZSI6IHsNCiAgICAgICAgIkV4dGVybmFsQ2xhaW1OYW1lIjogIiINCiAgICAgIH0sDQogICAgICAiRW1haWwiOiB7DQogICAgICAgICJFeHRlcm5hbENsYWltTmFtZSI6ICIiDQogICAgICB9LA0KICAgICAgIk1lbWJlck9mIjogew0KICAgICAgICAiRXh0ZXJuYWxDbGFpbU5hbWUiOiAiIg0KICAgICAgfQ0KICAgIH0sDQogICAgIkNsdXN0ZXJDb21tdW5pY2F0aW9uU2V0dGluZ3MiOiB7DQogICAgICAiVXNlS2Fma2EiOiB0cnVlLA0KICAgICAgIkthZmthQ2FjaGVUb3BpYyI6ICIiLA0KICAgICAgIkthZmthQ2xpZW50Q29uZmlnIjogew0KICAgICAgICAiQm9vdHN0cmFwU2VydmVycyI6ICJrYWZrYS1jbHVzdGVyLWthZmthLWJvb3RzdHJhcC5rYWZrYS5zdmMuY2x1c3Rlci5sb2NhbDo5MDkyIg0KICAgICAgfSwNCiAgICAgICJDbHVzdGVySXBBZGRyZXNzZXMiOiAiIiwNCiAgICAgICJDbHVzdGVyQ29tbXVuaWNhdGlvblByb3RvY29sIjogImh0dHAiLA0KICAgICAgIkNsdXN0ZXJDb21tdW5pY2F0aW9uQmFzZVVybCI6ICJ7UFJPVE9DT0x9Oi8ve0lQQUREUkVTU30vQ2luY2h5Ig0KICAgIH0NCiAgfSwNCiAgIkxvZ2dpbmciOiB7DQogICAgIkxvZ0xldmVsIjogew0KICAgICAgIkRlZmF1bHQiOiAiRGVidWciDQogICAgfQ0KICB9LA0KICAiU2VyaWxvZyI6IHsNCiAgICAiTWluaW11bUxldmVsIjogew0KICAgICAgIkRlZmF1bHQiOiAiRGVidWciLA0KCSAgIk92ZXJyaWRlIjogew0KCQkiTWljcm9zb2Z0IjogIldhcm5pbmciLA0KCQkiTWljcm9zb2Z0Lkhvc3RpbmcuTGlmZXRpbWUiOiAiSW5mb3JtYXRpb24iDQoJICB9DQogICAgfSwNCiAgICAiV3JpdGVUbyI6IFsNCiAgICAgIHsNCiAgICAgICAgIk5hbWUiOiAiQ29uc29sZSIsDQogICAgICAgICJBcmdzIjogew0KICAgICAgICAgICJmb3JtYXR0ZXIiOiAiU2VyaWxvZy5Gb3JtYXR0aW5nLkNvbXBhY3QuQ29tcGFjdEpzb25Gb3JtYXR0ZXIsIFNlcmlsb2cuRm9ybWF0dGluZy5Db21wYWN0Ig0KICAgICAgICB9DQogICAgICB9DQogICAgXQ0KICB9DQp9
- target:
    group: logging.banzaicloud.io
    version: v1beta1
    kind: Output
    name: idp-logging-stdout
  patch: |-
    - op: replace
      path: /spec/elasticsearch/index_name
      value: development-idp-app
- target:
    group: networking.istio.io
    version: v1alpha3
    kind: DestinationRule
    name: idp-destinationrule
  patch: |-
    - op: replace
      path: /spec/trafficPolicy/loadBalancer/consistentHash/httpCookie/name
      value: development-idp-canary